#N canvas -1706 -433 1706 1387 12;
#X obj 316 137 inlet;
#X msg 316 217 88;
#X obj 316 257 until;
#X obj 316 297 float;
#X msg 385 254 21;
#X obj 385 294 + 1;
#X text 385 136 <-- receives the name of an instrument folder;
#X text 385 216 <-- iterate once for each piano key;
#X text 429 293 <-- iterate all 88 midi notes \, 21-108;
#X obj 316 377 mod 12;
#X obj 316 417 select 0 1 2 3 4 5 6 7 8 9 10 11;
#X msg 594 475 A;
#X msg 697 475 B;
#X msg 167 475 C;
#X msg 363 475 E;
#X msg 394 475 F;
#X msg 491 475 G;
#X msg 199 475 C#;
#X msg 330 475 Eb;
#X msg 427 475 F#;
#X msg 524 475 G#;
#X msg 659 475 Bb;
#X msg 230 475 Db;
#X msg 263 475 D;
#X msg 296 475 D#;
#X msg 460 475 Gb;
#X msg 558 475 Ab;
#X msg 627 475 A#;
#X text 386 376 <-- mod 12 so that 0=C \, 1=C# \, etc;
#X text 558 415 <-- get all possible note names;
#X obj 795 377 / 12;
#X obj 795 475 int;
#X obj 795 417 - 1;
#X text 843 376 <-- divide by 12 to get the octave number;
#X obj 896 297 makefilename instruments/%s/%%s.wav;
#X msg 900 581 set \$1;
#X obj 900 621 makefilename;
#X obj 428 541 pack s f;
#X msg 428 581 symbol \$1\$2;
#X text 510 540 <-- combine note and octave to get all notes A0-C8;
#X obj 900 661 file_exists;
#X text 429 256 <-- initialize counter to 21 \, the first note (A0);
#X obj 861 702 spigot;
#X obj 135 702 spigot;
#X obj 316 337 t f f f f;
#X floatatom 102 377 5 0 0 0 - - - 0;
#X text 995 620 <-- here we have the relative path to a wav file;
#X text 1065 136 <-- for testing;
#X msg 896 137 symbol tubed_rhodes;
#X text 1065 173 <-- map midi notes to wav files;
#X obj 514 753 pack f s;
#X obj 102 416 t f f;
#X obj 101 783 select 108;
#X text 188 782 <-- selecting 108 runs at end of loop;
#X obj 101 863 outlet;
#X text 167 862 <-- return the note_to_wav map as a list;
#X text 995 657 <-- file_exists returns 1 if the file exists \, else 0;
#X obj 896 177 text define _note_to_wav;
#X obj 514 793 text insert _note_to_wav;
#X obj 101 823 text tolist _note_to_wav;
#X obj 896 257 text delete _note_to_wav;
#X obj 316 177 t b b b b s;
#X msg 896 217 -1;
#X text 1090 256 <-- ensure mapping is empty at start;
#X text 86 40 This subpatch receives the name of an instrument folder and returns a list of (midi_note_int \, path_to_sample.wav).;
#X connect 0 0 61 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 44 0;
#X connect 4 0 3 1;
#X connect 5 0 3 1;
#X connect 9 0 10 0;
#X connect 10 0 13 0;
#X connect 10 1 17 0;
#X connect 10 1 22 0;
#X connect 10 2 23 0;
#X connect 10 3 24 0;
#X connect 10 3 18 0;
#X connect 10 4 14 0;
#X connect 10 5 15 0;
#X connect 10 6 19 0;
#X connect 10 6 25 0;
#X connect 10 7 16 0;
#X connect 10 8 20 0;
#X connect 10 8 26 0;
#X connect 10 9 11 0;
#X connect 10 10 27 0;
#X connect 10 10 21 0;
#X connect 10 11 12 0;
#X connect 11 0 37 0;
#X connect 12 0 37 0;
#X connect 13 0 37 0;
#X connect 14 0 37 0;
#X connect 15 0 37 0;
#X connect 16 0 37 0;
#X connect 17 0 37 0;
#X connect 18 0 37 0;
#X connect 19 0 37 0;
#X connect 20 0 37 0;
#X connect 21 0 37 0;
#X connect 22 0 37 0;
#X connect 23 0 37 0;
#X connect 24 0 37 0;
#X connect 25 0 37 0;
#X connect 26 0 37 0;
#X connect 27 0 37 0;
#X connect 30 0 32 0;
#X connect 31 0 37 1;
#X connect 32 0 31 0;
#X connect 34 0 35 0;
#X connect 35 0 36 0;
#X connect 36 0 40 0;
#X connect 36 0 42 0;
#X connect 37 0 38 0;
#X connect 38 0 36 0;
#X connect 40 0 42 1;
#X connect 40 0 43 1;
#X connect 42 0 50 1;
#X connect 43 0 50 0;
#X connect 44 0 45 0;
#X connect 44 1 9 0;
#X connect 44 2 30 0;
#X connect 44 3 5 0;
#X connect 45 0 51 0;
#X connect 48 0 61 0;
#X connect 50 0 58 0;
#X connect 51 0 52 0;
#X connect 51 1 43 0;
#X connect 52 0 59 0;
#X connect 59 0 54 0;
#X connect 61 0 1 0;
#X connect 61 1 4 0;
#X connect 61 2 62 0;
#X connect 61 3 57 0;
#X connect 61 4 34 0;
#X connect 62 0 60 0;
